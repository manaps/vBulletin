(function(e){var t=e(window);var n={};var r=[];var i=[];var s;var o=null;var u="_open";var a="_close";var f=[];var l=null;var c;var h=/(iPad|iPhone|iPod)/g.test(navigator.userAgent);var p={_init:function(t){var n=e(t);var s=n.data("popupoptions");i[t.id]=false;r[t.id]=0;if(!n.data("popup-initialized")){n.attr("data-popup-initialized","true");p._initonce(t)}if(s.autoopen){setTimeout(function(){p.show(t,0)},0)}},_initonce:function(t){var n=e(t);var r=e("body");var i;var a=n.data("popupoptions");var f;o=parseInt(r.css("margin-right"),10);l=document.body.style.webkitTransition!==undefined||document.body.style.MozTransition!==undefined||document.body.style.msTransition!==undefined||document.body.style.OTransition!==undefined||document.body.style.transition!==undefined;if(a.type=="tooltip"){a.background=false;a.scrolllock=false}if(a.backgroundactive){a.background=false;a.blur=false;a.scrolllock=false}if(a.scrolllock){var c;var d;if(typeof s==="undefined"){c=e('<div style="width:50px;height:50px;overflow:auto"><div/></div>').appendTo("body");d=c.children();s=d.innerWidth()-d.height(99).innerWidth();c.remove()}}if(!n.attr("id")){n.attr("id","j-popup-"+parseInt(Math.random()*1e8,10))}n.addClass("popup_content");r.prepend(t);n.wrap('<div id="'+t.id+'_wrapper" class="popup_wrapper" />');i=e("#"+t.id+"_wrapper");i.css({opacity:0,visibility:"hidden",position:"absolute"});if(h){i.css("cursor","pointer")}if(a.type=="overlay"){i.css("overflow","auto")}n.css({opacity:0,visibility:"hidden",display:"inline-block"});if(a.setzindex&&!a.autozindex){i.css("z-index","100001")}if(!a.outline){n.css("outline","none")}if(a.transition){n.css("transition",a.transition);i.css("transition",a.transition)}n.attr("aria-hidden",true);if(a.background&&!e("#"+t.id+"_background").length){r.prepend('<div id="'+t.id+'_background" class="popup_background"></div>');var v=e("#"+t.id+"_background");v.css({opacity:0,visibility:"hidden",backgroundColor:a.color,position:"fixed",top:0,right:0,bottom:0,left:0});if(a.setzindex&&!a.autozindex){v.css("z-index","100000")}if(a.transition){v.css("transition",a.transition)}}if(a.type=="overlay"){n.css({textAlign:"left",position:"relative",verticalAlign:"middle"});f={position:"fixed",width:"100%",height:"100%",top:0,left:0,textAlign:"center"};if(a.backgroundactive){f.position="relative";f.height="0";f.overflow="visible"}i.css(f);i.append('<div class="popup_align" />');e(".popup_align").css({display:"inline-block",verticalAlign:"middle",height:"100%"})}n.attr("role","dialog");var m=a.openelement?a.openelement:"."+t.id+u;e(m).each(function(t,n){e(n).attr("data-popup-ordinal",t);if(!n.id){e(n).attr("id","open_"+parseInt(Math.random()*1e8,10))}});if(!(n.attr("aria-labelledby")||n.attr("aria-label"))){n.attr("aria-labelledby",e(m).attr("id"))}if(a.action=="hover"){a.keepfocus=false;e(m).on("mouseenter",function(n){p.show(t,e(this).data("popup-ordinal"))});e(m).on("mouseleave",function(e){p.hide(t)})}else{e(document).on("click",m,function(n){n.preventDefault();var r=e(this).data("popup-ordinal");setTimeout(function(){p.show(t,r)},0)})}if(a.detach){n.hide().detach()}else{i.hide()}},show:function(n,u){var h=e(n);if(h.data("popup-visible"))return;if(!h.data("popup-initialized")){p._init(n)}h.attr("data-popup-initialized","true");var v=e("body");var m=h.data("popupoptions");var g=e("#"+n.id+"_wrapper");var y=e("#"+n.id+"_background");d(n,u,m.beforeopen);i[n.id]=u;setTimeout(function(){f.push(n.id)},0);if(m.autozindex){var b=document.getElementsByTagName("*");var w=b.length;var E=0;for(var S=0;S<w;S++){var x=e(b[S]).css("z-index");if(x!=="auto"){x=parseInt(x,10);if(E<x){E=x}}}r[n.id]=E;if(m.background){if(r[n.id]>0){e("#"+n.id+"_background").css({zIndex:r[n.id]+1})}}if(r[n.id]>0){g.css({zIndex:r[n.id]+2})}}if(m.detach){g.prepend(n);h.show()}else{g.show()}c=setTimeout(function(){g.css({visibility:"visible",opacity:1});e("html").addClass("popup_visible").addClass("popup_visible_"+n.id);h.addClass("popup_content_visible")},20);if(m.scrolllock){v.css("overflow","hidden");if(v.height()>t.height()){v.css("margin-right",o+s)}}if(m.backgroundactive){h.css({top:(t.height()-(h.get(0).offsetHeight+parseInt(h.css("margin-top"),10)+parseInt(h.css("margin-bottom"),10)))/2+"px"})}h.css({visibility:"visible",opacity:1});if(m.background){y.css({visibility:"visible",opacity:m.opacity});setTimeout(function(){y.css({opacity:m.opacity})},0)}h.data("popup-visible",true);p.reposition(n,u);h.data("focusedelementbeforepopup",document.activeElement);if(m.keepfocus){h.attr("tabindex",-1);setTimeout(function(){if(m.focuselement==="closebutton"){e("#"+n.id+" ."+n.id+a+":first").focus()}else if(m.focuselement){e(m.focuselement).focus()}else{h.focus()}},m.focusdelay)}e(m.pagecontainer).attr("aria-hidden",true);h.attr("aria-hidden",false);d(n,u,m.onopen);if(l){g.one("transitionend",function(){d(n,u,m.opentransitionend)})}else{d(n,u,m.opentransitionend)}},hide:function(t){if(c)clearTimeout(c);var n=e("body");var r=e(t);var s=r.data("popupoptions");var u=e("#"+t.id+"_wrapper");var a=e("#"+t.id+"_background");r.data("popup-visible",false);if(f.length===1){e("html").removeClass("popup_visible").removeClass("popup_visible_"+t.id)}else{if(e("html").hasClass("popup_visible_"+t.id)){e("html").removeClass("popup_visible_"+t.id)}}f.pop();if(e("html").hasClass("popup_content_visible")){r.removeClass("popup_content_visible")}if(s.keepfocus){setTimeout(function(){if(e(r.data("focusedelementbeforepopup")).is(":visible")){r.data("focusedelementbeforepopup").focus()}},0)}u.css({visibility:"hidden",opacity:0});r.css({visibility:"hidden",opacity:0});if(s.background){a.css({visibility:"hidden",opacity:0})}e(s.pagecontainer).attr("aria-hidden",false);r.attr("aria-hidden",true);d(t,i[t.id],s.onclose);if(l&&r.css("transition-duration")!=="0s"){r.one("transitionend",function(e){if(!r.data("popup-visible")){if(s.detach){r.hide().detach()}else{u.hide()}}if(s.scrolllock){setTimeout(function(){n.css({overflow:"visible","margin-right":o})},10)}d(t,i[t.id],s.closetransitionend)})}else{if(s.detach){r.hide().detach()}else{u.hide()}if(s.scrolllock){setTimeout(function(){n.css({overflow:"visible","margin-right":o})},10)}d(t,i[t.id],s.closetransitionend)}},toggle:function(t,n){if(e(t).data("popup-visible")){p.hide(t)}else{setTimeout(function(){p.show(t,n)},0)}},reposition:function(n,r){var i=e(n);var s=i.data("popupoptions");var o=e("#"+n.id+"_wrapper");var a=e("#"+n.id+"_background");r=r||0;if(s.type=="tooltip"){o.css({position:"absolute"});var f;if(s.tooltipanchor){f=e(s.tooltipanchor)}else if(s.openelement){f=e(s.openelement).filter('[data-popup-ordinal="'+r+'"]')}else{f=e("."+n.id+u+'[data-popup-ordinal="'+r+'"]')}var l=f.offset();if(s.horizontal=="right"){o.css("left",l.left+f.outerWidth()+s.offsetleft)}else if(s.horizontal=="leftedge"){o.css("left",l.left+f.outerWidth()-f.outerWidth()+s.offsetleft)}else if(s.horizontal=="left"){o.css("right",t.width()-l.left-s.offsetleft)}else if(s.horizontal=="rightedge"){o.css("right",t.width()-l.left-f.outerWidth()-s.offsetleft)}else{o.css("left",l.left+f.outerWidth()/2-i.outerWidth()/2-parseFloat(i.css("marginLeft"))+s.offsetleft)}if(s.vertical=="bottom"){o.css("top",l.top+f.outerHeight()+s.offsettop)}else if(s.vertical=="bottomedge"){o.css("top",l.top+f.outerHeight()-i.outerHeight()+s.offsettop)}else if(s.vertical=="top"){o.css("bottom",t.height()-l.top-s.offsettop)}else if(s.vertical=="topedge"){o.css("bottom",t.height()-l.top-i.outerHeight()-s.offsettop)}else{o.css("top",l.top+f.outerHeight()/2-i.outerHeight()/2-parseFloat(i.css("marginTop"))+s.offsettop)}}else if(s.type=="overlay"){if(s.horizontal){o.css("text-align",s.horizontal)}else{o.css("text-align","center")}if(s.vertical){i.css("vertical-align",s.vertical)}else{i.css("vertical-align","middle")}}}};var d=function(t,n,r){var i=e(t).data("popupoptions");var s=i.openelement?i.openelement:"."+t.id+u;var o=e(s+'[data-popup-ordinal="'+n+'"]');if(typeof r=="function"){r.call(e(t),t,o)}};e(document).on("keydown",function(t){if(f.length){var n=f[f.length-1];var r=document.getElementById(n);if(e(r).data("popupoptions").escape&&t.keyCode==27){p.hide(r)}}});e(document).on("click",function(t){if(f.length){var n=f[f.length-1];var r=document.getElementById(n);var i=e(r).data("popupoptions").closeelement?e(r).data("popupoptions").closeelement:"."+r.id+a;if(e(t.target).closest(i).length){t.preventDefault();p.hide(r)}if(e(r).data("popupoptions").blur&&!e(t.target).closest("#"+n).length&&t.which!==2){p.hide(r);if(e(r).data("popupoptions").type==="overlay"){t.preventDefault()}}}});e(document).on("focusin",function(t){if(f.length){var n=f[f.length-1];var r=document.getElementById(n);if(e(r).data("popupoptions").keepfocus){if(!r.contains(t.target)){t.stopPropagation();r.focus()}}}});e.fn.popup=function(t){return this.each(function(){$el=e(this);if(typeof t==="object"){var r=e.extend({},e.fn.popup.defaults,t);$el.data("popupoptions",r);n=$el.data("popupoptions");p._init(this)}else if(typeof t==="string"){if(!$el.data("popupoptions")){$el.data("popupoptions",e.fn.popup.defaults);n=$el.data("popupoptions")}p[t].call(this,this)}else{if(!$el.data("popupoptions")){$el.data("popupoptions",e.fn.popup.defaults);n=$el.data("popupoptions")}p._init(this)}})};e.fn.popup.defaults={type:"overlay",autoopen:false,background:true,backgroundactive:false,color:"black",opacity:"0.5",horizontal:"center",vertical:"middle",offsettop:0,offsetleft:0,escape:true,blur:true,setzindex:true,autozindex:false,scrolllock:false,keepfocus:true,focuselement:null,focusdelay:50,outline:false,pagecontainer:null,detach:false,openelement:null,closeelement:null,transition:null,tooltipanchor:null,beforeopen:null,onclose:null,onopen:null,opentransitionend:null,closetransitionend:null}})(jQuery)