vBulletin.events.systemInit.subscribe(function(){if(vBulletin.elements.vB_ListBuilder){vBulletin.listBuilders=new Object();for(var D=0;D<vBulletin.elements.vB_ListBuilder.length;D++){var C=vBulletin.elements.vB_ListBuilder[D];if(typeof (C[2])!="undefined"){var B=C[2]}else{if(vBulletin.ajaxurls[C[1]]){var B=new Array(vBulletin.ajaxurls[C[1]][0],vBulletin.ajaxurls[C[1]][1])}else{var A=new Array("ajaxreq.php","do=fetch&field=%1$s");var E=new Array("ajaxreq.php","do=save&field=%1$s%2$s");var B=new Array(A,E)}}vBulletin.listBuilders[C[1]]=new vB_ListBuilder(C[0],C[1],B)}vBulletin.elements.vB_ListBuilder=null}});function vB_ListBuilder(C,A,B){vBulletin.console("vB_ListBuilder '%s' :: Creating vB_ListBuilder",A);this.element=YAHOO.util.Dom.get(C);this.elementkey=A;this.display_element=this.element;if(typeof (B)=="undefined"||!B){this.useajax=false;this.content_ready=true;this.init_controls()}else{if(typeof (vBulletin.events["vBmenuShow_"+this.elementkey])!="undefined"){this.fetchurl=B[0];this.saveurl=B[1];this.useajax=true;this.content_ready=false;vBulletin.events["vBmenuShow_"+this.elementkey].subscribe(this.fetch_values,this,true)}}this.select_item_id=null}vB_ListBuilder.prototype.select_item=function(C){if(C){YAHOO.util.Event.stopEvent(C)}this.select_item_id=2;if(this.content_ready){this.clear_selection();var B=false;for(var A=0;A<this.select_n.options.length;A++){if(this.select_n.options[A].value==this.select_item_id){this.select_n.options[A].setAttribute("selected",true);this.select_n.options[A].selected=true;B=true;break}}if(B){this.button_y.click()}this.select_item_id=null;vBmenu.hide()}else{vBmenu.menus[this.elementkey].show(vBmenu.menus[this.elementkey].controlobj)}};vB_ListBuilder.prototype.fetch_values=function(){if(this.content_ready==false){YAHOO.util.Connect.asyncRequest("POST",fetch_ajax_url(this.fetchurl[0]),{success:this.populate_selects,failure:this.populate_failed,timeout:5000,scope:this},construct_phrase(this.fetchurl[1],this.elementkey));vBulletin.console("vB_ListBuilder '%s' :: fetch_values()",this.elementkey)}};vB_ListBuilder.prototype.init_controls=function(){vBulletin.console("vB_ListBuilder '%s' :: init_controls()",this.elementkey);this.select_n=YAHOO.util.Dom.get(this.elementkey+"_select_n");YAHOO.util.Event.addListener(this.select_n,"dblclick",this.move_items,this,true);this.select_y=YAHOO.util.Dom.get(this.elementkey+"_select_y");YAHOO.util.Event.addListener(this.select_y,"dblclick",this.move_items,this,true);this.button_n=YAHOO.util.Dom.get(this.elementkey+"_button_n");YAHOO.util.Event.addListener(this.button_n,"click",this.move_items,this,true);this.button_y=YAHOO.util.Dom.get(this.elementkey+"_button_y");YAHOO.util.Event.addListener(this.button_y,"click",this.move_items,this,true);this.custom_i=YAHOO.util.Dom.get(this.elementkey+"_custom");if(this.custom_i){this.custom_i.setAttribute("autocomplete","off");YAHOO.util.Event.addListener(this.custom_i,"focus",this.clear_selection,this,true)}this.progress=YAHOO.util.Dom.get(this.elementkey+"_progress_image");if(this.select_n.form){vBulletin.console("vB_ListBuilder '%s' :: Found form",this.elementkey);YAHOO.util.Event.addListener(this.select_n.form,"submit",this.select_all,this,true)}};vB_ListBuilder.prototype.select_all=function(B){for(var A=0;A<this.select_y.options.length;A++){this.select_y.options[A].setAttribute("selected",true);this.select_y.options[A].selected=true}};vB_ListBuilder.prototype.populate_selects=function(G){vBulletin.console("vB_ListBuilder '%s' :: populate_selects()",this.elementkey);document.getElementById(this.elementkey+"_container").innerHTML=G.responseXML.getElementsByTagName("template")[0].firstChild.nodeValue;this.content_ready=true;this.init_controls();var D={n:"n",y:"y"};for(var B in D){if(!YAHOO.lang.hasOwnProperty(D,B)){continue}var A=this["select_"+B];while(A.hasChildNodes()){A.removeChild(A.firstChild)}var C=G.responseXML.getElementsByTagName(B)[0].getElementsByTagName("item");for(var F=0;F<C.length;F++){var E=document.createElement("option");E.value=C[F].getAttribute("itemid");E.innerHTML=C[F].firstChild.nodeValue;A.appendChild(E)}}vBulletin.console("vB_ListBuilder '%s' :: Activate custom input? %s",this.elementkey,G.responseXML.getElementsByTagName("createnewitem")[0].firstChild.nodeValue);if(G.responseXML.getElementsByTagName("createnewitem")[0].firstChild.nodeValue=="yes"){this.select_n.style.height=this.select_n.offsetHeight-this.custom_i.offsetHeight+"px"}else{if(this.custom_i.parentNode){this.custom_i.parentNode.removeChild(this.custom_i)}}this.fix_select_widths();if(this.select_item_id){this.select_item()}};vB_ListBuilder.prototype.fix_select_widths=function(){this.select_n.style.width=this.select_y.style.width=this.custom_i.style.width="auto";this.select_n.style.width=this.select_y.style.width=this.custom_i.style.width=Math.max(this.select_n.offsetWidth,this.select_y.offsetWidth,120)+"px";vBmenu.menus[this.elementkey].set_menu_position(this.element.parentNode)};vB_ListBuilder.prototype.clear_selection=function(){this.select_n.selectedIndex=this.select_y.selectedIndex=-1};vB_ListBuilder.prototype.move_items=function(E){YAHOO.util.Event.stopEvent(E);var I=YAHOO.util.Event.getTarget(E);if(I==this.button_n||I==this.select_y||YAHOO.util.Dom.isAncestor(this.select_y,I)){var G=this.select_n;var H=this.select_y;vBulletin.console("vB_ListBuilder '%s' :: move_items(Y->N)",this.elementkey)}else{var G=this.select_y;var H=this.select_n;vBulletin.console("vB_ListBuilder '%s' :: move_items(N->Y)",this.elementkey);if(this.custom_i&&this.custom_i.parentNode&&(this.custom_i.value=PHP.trim(this.custom_i.value))!=""){vBulletin.console("vB_ListBuilder '%s' :: Found custom value of '%s'.",this.custom_i.value);var B=document.createElement("option");B.innerHTML=this.custom_i.value;B.value=this.custom_i.value;B.setAttribute("selected",true);B.selected=true;this.select_n.appendChild(B);this.custom_i.value=""}}var A=new Array();for(var D=0;D<H.options.length;D++){if(H.options[D].selected){A.push(D)}}this.clear_selection();while(typeof (D=A.pop())!="undefined"){var F=document.createElement("option");F.innerHTML=H.options[D].innerHTML;F.value=H.options[D].value;F.setAttribute("selected",true);F.selected=true;H.remove(D);for(var C=0;C<G.options.length;C++){if(F.innerHTML.toLowerCase()<=G.options[C].innerHTML.toLowerCase()){G.insertBefore(F,G.options[C]);F=null;break}}if(F){G.appendChild(F)}}this.save_values()};vB_ListBuilder.prototype.save_values=function(){if(this.useajax){var B="";for(var A=0;A<this.select_y.options.length;A++){B+=construct_phrase("&value[%2$s]=%3$s",this.elementkey,this.select_y.options[A].getAttribute("value"),PHP.urlencode(this.select_y.options[A].innerHTML))}if(B==""){B=construct_phrase("&%1$s=0",this.elementkey)}vBulletin.console("vB_ListBuilder '%s' :: save_values() (%s)",this.elementkey,B);if(!this.saver){this.set_temp_values();this.saver=YAHOO.util.Connect.asyncRequest("POST",fetch_ajax_url(this.saveurl[0]),{success:this.save_complete,failure:this.buggerup,timeout:5000,scope:this},construct_phrase(this.saveurl[1],PHP.urlencode(this.elementkey),B))}else{vBulletin.console("vB_ListBuilder '%s' :: save_values() ALREADY IN PROGRESS")}}};vB_ListBuilder.prototype.set_temp_values=function(){var A=this.fetch_select_options_array(this.select_y,"text").join(", ");vBulletin.console("vB_ListBuilder '%s' :: set temp values(%s)",this.elementkey,A);this.progress.style.visibility="visible";this.select_n.setAttribute("disabled",true);this.select_y.setAttribute("disabled",true);this.button_n.setAttribute("disabled",true);this.button_y.setAttribute("disabled",true);YAHOO.util.Dom.addClass(this.display_element,"shade");this.display_element.innerHTML=A};vB_ListBuilder.prototype.save_complete=function(A){vBulletin.console("vB_ListBuilder '%s' :: save_complete()",this.elementkey);YAHOO.util.Dom.removeClass(this.display_element,"shade");this.display_element.innerHTML=this.fetch_select_options_array(this.select_y,"text").join(", ");if(this.display_element.innerHTML==""){this.display_element.innerHTML=A.responseXML.getElementsByTagName("noneword")[0].firstChild.nodeValue}this.fix_select_widths();this.select_n.removeAttribute("disabled");this.select_y.removeAttribute("disabled");this.select_y.disabled=false;this.button_n.removeAttribute("disabled");this.button_y.removeAttribute("disabled");this.progress.style.visibility="hidden";this.saver=null};vB_ListBuilder.prototype.fetch_select_options_array=function(D,C){var A=new Array();for(var B=0;B<D.options.length;B++){switch(C){case"values":A[A.length]=D.options[B].getAttribute("value");break;case"both":A[D.options[B].getAttribute("value")]=D.options[B].innerHTML;break;case"text":default:A[A.length]=D.options[B].innerHTML;break}}return A};